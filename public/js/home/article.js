!function(t){var e={};function n(o){if(e[o])return e[o].exports;var a=e[o]={i:o,l:!1,exports:{}};return t[o].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(o,a,function(e){return t[e]}.bind(null,a));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n(n.s=4)}({4:function(t,e,n){t.exports=n("PDmh")},GemG:function(t,e,n){var o,a,r;a=[t,e],void 0===(r="function"==typeof(o=function(t,e){"use strict";var n,o,a="function"==typeof Map?new Map:(n=[],o=[],{has:function(t){return n.indexOf(t)>-1},get:function(t){return o[n.indexOf(t)]},set:function(t,e){-1===n.indexOf(t)&&(n.push(t),o.push(e))},delete:function(t){var e=n.indexOf(t);e>-1&&(n.splice(e,1),o.splice(e,1))}}),r=function(t){return new Event(t,{bubbles:!0})};try{new Event("test")}catch(t){r=function(t){var e=document.createEvent("Event");return e.initEvent(t,!0,!1),e}}function i(t){if(t&&t.nodeName&&"TEXTAREA"===t.nodeName&&!a.has(t)){var e,n=null,o=null,i=null,s=function(){t.clientWidth!==o&&u()},c=function(e){window.removeEventListener("resize",s,!1),t.removeEventListener("input",u,!1),t.removeEventListener("keyup",u,!1),t.removeEventListener("autosize:destroy",c,!1),t.removeEventListener("autosize:update",u,!1),Object.keys(e).forEach((function(n){t.style[n]=e[n]})),a.delete(t)}.bind(t,{height:t.style.height,resize:t.style.resize,overflowY:t.style.overflowY,overflowX:t.style.overflowX,wordWrap:t.style.wordWrap});t.addEventListener("autosize:destroy",c,!1),"onpropertychange"in t&&"oninput"in t&&t.addEventListener("keyup",u,!1),window.addEventListener("resize",s,!1),t.addEventListener("input",u,!1),t.addEventListener("autosize:update",u,!1),t.style.overflowX="hidden",t.style.wordWrap="break-word",a.set(t,{destroy:c,update:u}),"vertical"===(e=window.getComputedStyle(t,null)).resize?t.style.resize="none":"both"===e.resize&&(t.style.resize="horizontal"),n="content-box"===e.boxSizing?-(parseFloat(e.paddingTop)+parseFloat(e.paddingBottom)):parseFloat(e.borderTopWidth)+parseFloat(e.borderBottomWidth),isNaN(n)&&(n=0),u()}function d(e){var n=t.style.width;t.style.width="0px",t.offsetWidth,t.style.width=n,t.style.overflowY=e}function l(){if(0!==t.scrollHeight){var e=function(t){for(var e=[];t&&t.parentNode&&t.parentNode instanceof Element;)t.parentNode.scrollTop&&e.push({node:t.parentNode,scrollTop:t.parentNode.scrollTop}),t=t.parentNode;return e}(t),a=document.documentElement&&document.documentElement.scrollTop;t.style.height="",t.style.height=t.scrollHeight+n+"px",o=t.clientWidth,e.forEach((function(t){t.node.scrollTop=t.scrollTop})),a&&(document.documentElement.scrollTop=a)}}function u(){l();var e=Math.round(parseFloat(t.style.height)),n=window.getComputedStyle(t,null),o="content-box"===n.boxSizing?Math.round(parseFloat(n.height)):t.offsetHeight;if(o<e?"hidden"===n.overflowY&&(d("scroll"),l(),o="content-box"===n.boxSizing?Math.round(parseFloat(window.getComputedStyle(t,null).height)):t.offsetHeight):"hidden"!==n.overflowY&&(d("hidden"),l(),o="content-box"===n.boxSizing?Math.round(parseFloat(window.getComputedStyle(t,null).height)):t.offsetHeight),i!==o){i=o;var a=r("autosize:resized");try{t.dispatchEvent(a)}catch(t){}}}}function s(t){var e=a.get(t);e&&e.destroy()}function c(t){var e=a.get(t);e&&e.update()}var d=null;"undefined"==typeof window||"function"!=typeof window.getComputedStyle?((d=function(t){return t}).destroy=function(t){return t},d.update=function(t){return t}):((d=function(t,e){return t&&Array.prototype.forEach.call(t.length?t:[t],(function(t){return i(t)})),t}).destroy=function(t){return t&&Array.prototype.forEach.call(t.length?t:[t],s),t},d.update=function(t){return t&&Array.prototype.forEach.call(t.length?t:[t],c),t}),e.default=d,t.exports=e.default})?o.apply(e,a):o)||(t.exports=r)},PDmh:function(t,e,n){"use strict";n.r(e);var o=n("GemG"),a=n.n(o);function r(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.J_previewBtn=$("#J_previewBtn"),this.J_previewEditorBtn=$("#J_previewEditorBtn"),this.J_textArea=$("#J_textArea"),this.J_previewMarkdown=$("#J_previewMarkdown"),this.J_commentBtn=$("#J_commentBtn"),this.J_updateCommentBtn=$("#J_updateCommentBtn"),this.J_commentList=$("#J_commentList"),this.J_commentNumber=$("#J_commentNumber"),this.J_loadMoreBtn=$("#J_loadMoreBtn"),this._id=this.J_textArea.data("article"),this._currentCommentNum=Number(this.J_commentNumber.text()),this._socialiteUserID=this.J_textArea.data("userid")||"",this._currentPage=1,this._totalPage=0,this._replyUserID=0,this._commentsAPI="/post/".concat(this._id,"/comments"),this._currentCommentAPI="/comments/",this._editCommentsAPI="/comments/update/",tocbot.init({tocSelector:".tocbot",contentSelector:".article-entry",headingSelector:"h1, h2, h3, h4, h5, h6",hasInnerContainers:!0,scrollSmooth:!0,positionFixedSelector:".tocbot",positionFixedClass:"is-position-fixed",fixedSidebarOffset:"auto"}),this.fetchComments(),this.initComments()}var e,n,o;return e=t,(n=[{key:"fetchComments",value:function(){var t=this;$.ajax({type:"GET",url:this._commentsAPI+"?current_page=".concat(this._currentPage),cache:!1,dataType:"json",success:function(e){0===e.status&&(t._totalPage=e.body.pagination.lastPage,e.body.list.map((function(e){t.J_commentList.append(t.renderComment({id:e.id,userId:e.user.id,avatar:e.user.avatar,nick_name:e.user.nick_name,time:e.time,content:e.content}))})),t._totalPage>1&&t._currentPage<t._totalPage?t.J_loadMoreBtn.removeClass("hide"):(1==t._totalPage||t._currentPage>=t._totalPage)&&t.J_loadMoreBtn.addClass("hide"))}})}},{key:"initComments",value:function(){var t=this;a()(this.J_textArea),this.J_previewBtn.on("click",(function(e){""!==t.J_textArea.val()&&$.ajax({type:"POST",url:previewAPI,cache:!1,dataType:"json",data:{markdown:t.J_textArea.val()},success:function(e){0===e.status&&(t.J_previewMarkdown.html(e.body.content),t.J_previewMarkdown.removeClass("hide"),t.J_textArea.addClass("hide"),t.J_previewEditorBtn.removeClass("hide"),t.J_previewBtn.addClass("hide"))}})})),this.J_previewEditorBtn.on("click",(function(e){t.J_previewMarkdown.addClass("hide"),t.J_textArea.removeClass("hide"),t.J_previewEditorBtn.addClass("hide"),t.J_previewBtn.removeClass("hide")})),this.J_commentBtn.on("click",(function(e){""!==t.J_textArea.val()&&$.ajax({type:"POST",url:postCommentAPI,cache:!1,dataType:"json",data:{article_id:t.J_textArea.data("article"),markdown:t.J_textArea.val(),replyId:t._replyUserID},success:function(e){0===e.status?(t.J_commentList.prepend(t.renderComment({id:e.body.id,userId:e.body.user.id,avatar:e.body.user.avatar,nick_name:e.body.user.nick_name,time:e.body.time,content:e.body.content})),t.J_textArea.val(""),a.a.update(t.J_textArea),t.J_previewMarkdown.html(""),t._replyUserID=0,t.J_previewEditorBtn.click(),t.J_commentNumber.text(t._currentCommentNum+1)):4001===e.status?layer.msg(e.msg,{time:1e3}):1001===e.status&&(layer.msg(e.msg,{time:1e3}),setTimeout((function(){window.location.reload()}),1e3))}})})),this.J_commentList.on("click",".J_replaybtn",(function(e){e.preventDefault();var n=$(e.target).data("id"),o=$(e.target).data("username");t._replyUserID=$(e.target).data("userid"),$.ajax({type:"GET",dataType:"json",cache:!1,url:t._currentCommentAPI+n,success:function(e){if(0===e.status){$("html,body").animate({scrollTop:$(t.J_textArea).offset().top},"fast");var n=e.body.markdown,r=[];n.split("\n").map((function(t){r.push("> "+t)})),r.push("\n");var i="> [@".concat(o,"](https://github.com/").concat(o,")\n")+r.join("\n");t.J_textArea.val(i),a.a.update(t.J_textArea),t.J_textArea.scrollTop($("#J_textArea")[0].scrollHeight)}}})})),this.J_textArea.bind("input propertychange",(function(e){0===$(e.target).val().length&&""!=t._socialiteUserID&&(t.J_updateCommentBtn.data("id",0),t.J_updateCommentBtn.addClass("hide"),t.J_commentBtn.removeClass("hide"),t._replyUserID=0)})),this.J_loadMoreBtn.on("click",(function(e){t._currentPage++,t.fetchComments()})),this.J_commentList.on("click",".J_editbtn",(function(e){e.preventDefault();var n=$(e.target).data("id");$(e.target).data("username"),$.ajax({type:"GET",dataType:"json",cache:!1,url:t._currentCommentAPI+n,success:function(e){if(0===e.status){$("html,body").animate({scrollTop:$(t.J_textArea).offset().top},"fast");var o=e.body.markdown;t.J_textArea.val(o),a.a.update(t.J_textArea),t.J_textArea.scrollTop($("#J_textArea")[0].scrollHeight),t.J_updateCommentBtn.data("id",n),t.J_updateCommentBtn.removeClass("hide"),t.J_commentBtn.addClass("hide")}}})})),this.J_updateCommentBtn.on("click",(function(e){$.ajax({type:"POST",url:t._editCommentsAPI+t.J_updateCommentBtn.data("id"),cache:!1,dataType:"json",data:{markdown:t.J_textArea.val()},success:function(e){0===e.status&&(t.J_updateCommentBtn.data("id",0),t.J_updateCommentBtn.addClass("hide"),t.J_commentBtn.removeClass("hide"),t.J_textArea.val(""),a.a.update(t.J_textArea),$(".comment-item".concat(e.body.id," .comment-body")).html(e.body.content),$("html,body").animate({scrollTop:$(".comment-item".concat(e.body.id)).offset().top},"fast"))}})}))}},{key:"renderComment",value:function(t){var e='<div class="icon-comments replay-btn J_replaybtn" data-id="'.concat(t.id,'" data-userid="').concat(t.userId,'"  data-username = ').concat(t.nick_name,"></div>");return this._socialiteUserID==t.userId&&(e='<div class="icon-edit edit-btn J_editbtn" data-id="'.concat(t.id,'" data-userid="').concat(t.userId,'" data-username = ').concat(t.nick_name,"></div>")),'<div class="cm-comment-list-item comment-item'.concat(t.id,'">\n                                <div class="avatar">\n                                    <img src="').concat(t.avatar,'" alt="头像">\n                                </div>\n                                <div class="comment-content">\n                                    <div class="comment-header">\n                                        <div class="left-panel">\n                                            <a href="https://github.com/').concat(t.nick_name,'" class="comment-username">').concat(t.nick_name,'</a>\n                                            <span class="comment-text">发表于</span>\n                                            <span class="comment-date">').concat(t.time,'</span>\n                                        </div>\n                                        <div class="reply-panel">\n                                            ').concat(e,'\n                                        </div>\n                                    </div>\n                                    <div class="comment-body markdown-body">\n                                        ').concat(t.content,"\n                                    </div>\n                                </div>\n                            </div>")}}])&&r(e.prototype,n),o&&r(e,o),t}())}});